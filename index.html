<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Task Masters - Connect with skilled professionals for all your service needs">
    <meta name="theme-color" content="#4A90E2">
    <title>Task Masters - Your Trusted Service Marketplace</title>
    <link rel="stylesheet" href="styles.css">
    <script src="location.js"></script>
    <style>
        body.dark-mode { background: #0a0e1a !important; color: #e0e8ff; }
        body.dark-mode .hero { background: linear-gradient(135deg, rgba(20, 40, 80, 0.8) 0%, rgba(30, 50, 90, 0.8) 100%) !important; }
        body.dark-mode h1, body.dark-mode h2, body.dark-mode h3 { color: #ffffff; }
        body.dark-mode p { color: #e0e8ff; }
        body.dark-mode .modern-navbar { background: rgba(20, 40, 80, 0.4) !important; border-bottom: 1px solid rgba(102, 126, 234, 0.3); }
        body.dark-mode .service-card, body.dark-mode .feature-card { background: rgba(20, 40, 80, 0.4); border: 1px solid rgba(102, 126, 234, 0.3); }
        body.dark-mode .footer { background: rgba(20, 40, 80, 0.4); border-top: 1px solid rgba(102, 126, 234, 0.3); }
        body.dark-mode .footer h3, body.dark-mode .footer h4, body.dark-mode .footer p, body.dark-mode .footer a { color: #e0e8ff; }
    </style>
    <script>
        (function() {
            try {
                const custSettings = JSON.parse(localStorage.getItem('customerSettings') || '{}');
                const provSettings = JSON.parse(localStorage.getItem('providerSettings') || '{}');
                if (custSettings.darkMode === true || provSettings.darkMode === true) {
                    document.documentElement.classList.add('dark-mode');
                    document.body.classList.add('dark-mode');
                }
            } catch(e) {}
        })();
    </script>
</head>
<body>
    <!-- DEBUG BANNER - Shows current login state (HIDDEN) -->
    <div id="debugBanner" style="position: fixed; top: 0; left: 0; right: 0; background: #000; color: #0f0; padding: 5px 15px; font-family: monospace; font-size: 12px; z-index: 99999; display: none; justify-content: space-between;">
        <span id="debugStatus">Loading...</span>
        <button onclick="document.getElementById('debugBanner').style.display='none'" style="background: #333; color: #fff; border: none; padding: 2px 8px; cursor: pointer;">X</button>
    </div>
    <script>
        // Immediate check on page load - before DOMContentLoaded
        (function() {
            const isLoggedIn = localStorage.getItem('customerLoggedIn');
            const hasUser = !!localStorage.getItem('customerUser');
            console.log('üîç INDEX.HTML - IMMEDIATE CHECK');
            console.log('customerLoggedIn:', isLoggedIn);
            console.log('customerUser exists:', hasUser);
            
            setTimeout(function() {
                const banner = document.getElementById('debugStatus');
                if (banner) {
                    if (isLoggedIn === 'true') {
                        banner.textContent = '‚úÖ LOGGED IN | customerLoggedIn=' + isLoggedIn + ' | customerUser=' + (hasUser ? 'EXISTS' : 'MISSING');
                        banner.parentElement.style.background = '#004400';
                    } else {
                        banner.textContent = '‚ùå NOT LOGGED IN | customerLoggedIn=' + (isLoggedIn || 'null') + ' | customerUser=' + (hasUser ? 'EXISTS' : 'MISSING');
                        banner.parentElement.style.background = '#440000';
                    }
                }
            }, 50);
        })();
    </script>
    
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h2>üéØ Task Masters</h2>
            </div>
            
            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle" id="mobileMenuToggle" onclick="toggleMobileMenu()" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            
            <div class="nav-links" id="navLinks">
                <a href="index.html">Home</a>
                <a href="services-browse.html">Services</a>
                <a href="#how-it-works">How it Works</a>
                <a href="#about">About</a>
                <button class="btn-login" id="loginBtn" onclick="window.location.href='login.html'" style="padding: 12px 30px; font-size: 16px;">Login</button>
                <script>
                    // IMMEDIATE login check - runs synchronously right after button is created
                    (function() {
                        const isCustomerLoggedIn = localStorage.getItem('customerLoggedIn') === 'true';
                        const isProviderLoggedIn = localStorage.getItem('providerLoggedIn') === 'true';
                        const btn = document.getElementById('loginBtn');
                        
                        if (btn && isCustomerLoggedIn) {
                            btn.outerHTML = '<a href="customer-dashboard.html" class="btn-login" id="dashboardBtn" style="text-decoration: none; display: inline-block; padding: 12px 30px; font-size: 16px;">My Dashboard</a>';
                            console.log('‚úÖ IMMEDIATE: Updated button to My Dashboard (customer)');
                        } else if (btn && isProviderLoggedIn) {
                            btn.outerHTML = '<a href="provider.html" class="btn-login" id="dashboardBtn" style="text-decoration: none; display: inline-block; padding: 12px 30px; font-size: 16px;">My Dashboard</a>';
                            console.log('‚úÖ IMMEDIATE: Updated button to My Dashboard (provider)');
                        } else {
                            console.log('‚ÑπÔ∏è IMMEDIATE: Keeping Login button');
                        }
                    })();
                </script>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-content">
            <h1 class="hero-title">Get Things Done by Skilled Professionals</h1>
            <p class="hero-subtitle">Book trusted service providers for home repairs, cleaning, beauty, wellness, and more</p>
            
            <a href="#how-it-works" class="commission-badge" style="display: block; text-decoration: none; cursor: pointer; transition: transform 0.3s ease;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                <span class="badge-icon">üéâ</span>
                <span class="badge-text">Find Your Local Professionals at 0% Commission</span>
            </a>
            
            <div class="search-bar" style="position: relative;">
                <input type="text" id="serviceSearch" placeholder="What service do you need? (e.g., plumber, cleaner, tutor)" autocomplete="off" oninput="showSearchSuggestions(this.value)" onfocus="showSearchSuggestions(this.value)" />
                <button class="btn-search" onclick="searchService()">üîç Search</button>
                <div id="searchSuggestions" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #e0e0e0; border-top: none; border-radius: 0 0 15px 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 400px; overflow-y: auto; z-index: 1000; margin-top: -1px;"></div>
            </div>

            <div class="quick-stats">
                <div class="stat-item">
                    <strong>50,000+</strong>
                    <span>Service Providers</span>
                </div>
                <div class="stat-item">
                    <strong>500,000+</strong>
                    <span>Happy Customers</span>
                </div>
                <div class="stat-item">
                    <strong>100+</strong>
                    <span>Services Available</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Services Section -->
    <section id="services" class="services-section">
        <h2 class="section-title">Popular Services</h2>
        <p class="section-subtitle">Browse our most requested services</p>
        
        <div class="services-grid">
            <div class="service-card" onclick="selectService('Cleaning')">
                <div class="service-icon">üßπ</div>
                <h3>Home Cleaning</h3>
                <p>Deep cleaning, regular maintenance</p>
            </div>
            <div class="service-card" onclick="selectService('Plumbing')">
                <div class="service-icon">üîß</div>
                <h3>Plumbing</h3>
                <p>Repairs, installations, maintenance</p>
            </div>
            <div class="service-card" onclick="selectService('Electrical')">
                <div class="service-icon">‚ö°</div>
                <h3>Electrical Work</h3>
                <p>Wiring, fixtures, troubleshooting</p>
            </div>
            <div class="service-card" onclick="selectService('Carpentry')">
                <div class="service-icon">ü™ö</div>
                <h3>Carpentry</h3>
                <p>Furniture assembly, repairs</p>
            </div>
            <div class="service-card" onclick="selectService('Painting')">
                <div class="service-icon">üé®</div>
                <h3>Painting</h3>
                <p>Interior, exterior, touch-ups</p>
            </div>
            <div class="service-card" onclick="selectService('Beauty')">
                <div class="service-icon">üíá</div>
                <h3>Beauty & Salon</h3>
                <p>Hair, makeup, spa services</p>
            </div>
            <div class="service-card" onclick="selectService('Tutoring')">
                <div class="service-icon">üìö</div>
                <h3>Tutoring</h3>
                <p>Academic subjects, skills training</p>
            </div>
            <div class="service-card" onclick="selectService('Pest Control')">
                <div class="service-icon">üêõ</div>
                <h3>Pest Control</h3>
                <p>Inspection, treatment, prevention</p>
            </div>
            <div class="service-card" onclick="selectService('AC Repair')">
                <div class="service-icon">‚ùÑÔ∏è</div>
                <h3>AC Repair</h3>
                <p>Installation, servicing, repair</p>
            </div>
            <div class="service-card" onclick="selectService('Babysitting')">
                <div class="service-icon">üë∂</div>
                <h3>Babysitting</h3>
                <p>Childcare, nanny services</p>
            </div>
            <div class="service-card" onclick="selectService('Moving')">
                <div class="service-icon">üì¶</div>
                <h3>Moving & Packing</h3>
                <p>Relocation, packing services</p>
            </div>
            <div class="service-card" onclick="selectService('Fitness')">
                <div class="service-icon">üí™</div>
                <h3>Personal Training</h3>
                <p>Fitness, yoga, nutrition coaching</p>
            </div>
            <div class="service-card" onclick="selectService('Dog Sitting')">
                <div class="service-icon">üêï</div>
                <h3>Dog Sitting</h3>
                <p>Dog walking, sitting, training</p>
            </div>
            <div class="service-card" onclick="selectService('Cat Sitting')">
                <div class="service-icon">üêà</div>
                <h3>Cat Sitting</h3>
                <p>Cat care, feeding, playtime</p>
            </div>
            <div class="service-card" onclick="selectService('Pet Grooming')">
                <div class="service-icon">üêæ</div>
                <h3>Pet Grooming</h3>
                <p>Bathing, trimming, nail care</p>
            </div>
            <div class="service-card" onclick="selectService('Makeup Artist')">
                <div class="service-icon">üíÑ</div>
                <h3>Makeup Artist</h3>
                <p>Bridal, party, professional makeup</p>
            </div>
            <div class="service-card" onclick="selectService('Hairstylist')">
                <div class="service-icon">‚úÇÔ∏è</div>
                <h3>Hairstylist at Home</h3>
                <p>Haircut, styling, coloring (all genders)</p>
            </div>
            <div class="service-card" onclick="selectService('Massage')">
                <div class="service-icon">üíÜ</div>
                <h3>Massage Therapy</h3>
                <p>Relaxation, deep tissue, sports</p>
            </div>
            <div class="service-card" onclick="selectService('Yoga Instructor')">
                <div class="service-icon">üßò</div>
                <h3>Yoga Instructor</h3>
                <p>Private sessions, all levels</p>
            </div>
            <div class="service-card" onclick="selectService('Concierge')">
                <div class="service-icon">üé©</div>
                <h3>Concierge Service</h3>
                <p>Personal assistant, errands, planning</p>
            </div>
            <div class="service-card" onclick="selectService('Personal Chef')">
                <div class="service-icon">üë®‚Äçüç≥</div>
                <h3>Personal Chef</h3>
                <p>Meal prep, cooking, catering</p>
            </div>
            <div class="service-card" onclick="selectService('Maid Service')">
                <div class="service-icon">üßπ</div>
                <h3>Maid Service</h3>
                <p>Housekeeping, live-in, part-time</p>
            </div>
            <div class="service-card" onclick="selectService('Manicure Pedicure')">
                <div class="service-icon">üíÖ</div>
                <h3>Nail Technician</h3>
                <p>Manicure, pedicure, nail art</p>
            </div>
            <div class="service-card" onclick="selectService('Dietitian')">
                <div class="service-icon">ü•ó</div>
                <h3>Dietitian & Nutrition</h3>
                <p>Meal planning, diet consultation</p>
            </div>
            <div class="service-card" onclick="selectService('Physiotherapy')">
                <div class="service-icon">üè•</div>
                <h3>Physiotherapy</h3>
                <p>Rehabilitation, pain management</p>
            </div>
            <div class="service-card" onclick="selectService('Photographer')">
                <div class="service-icon">üì∏</div>
                <h3>Professional Photography</h3>
                <p>Events, portraits, product shoots</p>
            </div>
            <div class="service-card" onclick="selectService('Wedding Planner')">
                <div class="service-icon">üíç</div>
                <h3>Wedding Planner</h3>
                <p>Complete wedding planning & coordination</p>
            </div>
            <div class="service-card" onclick="selectService('Event Planner')">
                <div class="service-icon">üéâ</div>
                <h3>Event Planner</h3>
                <p>Birthday, corporate, social events</p>
            </div>
            <div class="service-card" onclick="selectService('Wedding Decorator')">
                <div class="service-icon">üíê</div>
                <h3>Wedding Decorator</h3>
                <p>Venue decoration, floral arrangements</p>
            </div>
            <div class="service-card" onclick="selectService('Event Decorator')">
                <div class="service-icon">üéà</div>
                <h3>Event Decorator</h3>
                <p>Party decoration, balloon art, themes</p>
            </div>
            <div class="service-card" onclick="selectService('Mehendi Artist')">
                <div class="service-icon">üé®</div>
                <h3>Mehendi Artist</h3>
                <p>Bridal, Arabic, traditional designs</p>
            </div>
            <div class="service-card" onclick="selectService('Tailor')">
                <div class="service-icon">üßµ</div>
                <h3>Tailor & Alterations</h3>
                <p>Clothing alterations, custom stitching</p>
            </div>
            <div class="service-card" onclick="selectService('Catering')">
                <div class="service-icon">üçΩÔ∏è</div>
                <h3>Catering Service</h3>
                <p>Party catering, meal delivery</p>
            </div>
            <div class="service-card" onclick="selectService('DJ')">
                <div class="service-icon">üéµ</div>
                <h3>DJ & Music</h3>
                <p>Party DJ, wedding entertainment</p>
            </div>
            <div class="service-card" onclick="selectService('Videographer')">
                <div class="service-icon">üé•</div>
                <h3>Videography</h3>
                <p>Wedding videos, event coverage</p>
            </div>
            <div class="service-card" onclick="selectService('Dance Teacher')">
                <div class="service-icon">üíÉ</div>
                <h3>Dance Instructor</h3>
                <p>Bollywood, classical, contemporary</p>
            </div>
            <div class="service-card" onclick="selectService('Music Teacher')">
                <div class="service-icon">üé∏</div>
                <h3>Music Teacher</h3>
                <p>Guitar, piano, vocals, instruments</p>
            </div>
            <div class="service-card" onclick="selectService('Astrologer')">
                <div class="service-icon">üîÆ</div>
                <h3>Astrologer</h3>
                <p>Astrology consultation, horoscope</p>
            </div>
            <div class="service-card" onclick="selectService('Interior Designer')">
                <div class="service-icon">üõãÔ∏è</div>
                <h3>Interior Designer</h3>
                <p>Home design, space planning</p>
            </div>
            <div class="service-card" onclick="selectService('Gardener')">
                <div class="service-icon">üå±</div>
                <h3>Gardening & Landscaping</h3>
                <p>Garden maintenance, landscaping</p>
            </div>
            <div class="service-card" onclick="selectService('Car Wash')">
                <div class="service-icon">üöó</div>
                <h3>Car Wash at Home</h3>
                <p>Car cleaning, detailing, waxing</p>
            </div>
            <div class="service-card" onclick="selectService('Home Appliance Repair')">
                <div class="service-icon">üîå</div>
                <h3>Appliance Repair</h3>
                <p>Refrigerator, washing machine, etc.</p>
            </div>
            <div class="service-card" onclick="selectService('Pandit')">
                <div class="service-icon">üïâÔ∏è</div>
                <h3>Pandit for Puja</h3>
                <p>Religious ceremonies, home puja</p>
            </div>
            <div class="service-card" onclick="selectService('Barber')">
                <div class="service-icon">üíà</div>
                <h3>Barber at Home</h3>
                <p>Haircut, beard grooming, shave</p>
            </div>
            <div class="service-card" onclick="selectService('Tattoo Artist')">
                <div class="service-icon">üñäÔ∏è</div>
                <h3>Tattoo Artist</h3>
                <p>Permanent, temporary, henna tattoos</p>
            </div>
        </div>
    </section>

    <!-- How It Works -->
    <section id="how-it-works" class="how-it-works">
        <h2 class="section-title">How It Works</h2>
        
        <!-- Zero Commission Banner -->
        <div style="background: linear-gradient(135deg, #4A90E2 0%, #357ABD 100%); padding: 30px; border-radius: 15px; margin: 30px auto; max-width: 800px; text-align: center; box-shadow: 0 4px 15px rgba(74,144,226,0.3);">
            <h3 style="color: white; font-size: 2rem; margin-bottom: 15px;">üíØ We Don't Take Commission</h3>
            <p style="color: white; font-size: 1.1rem; line-height: 1.6; margin: 0;">
                Unlike other platforms that charge 15-30% commission, <strong>Task Masters charges 0% commission</strong>. 
                The price you see is the price you pay directly to the service provider. We believe in supporting local small businesses, 
                not taking a cut from their hard-earned income.
            </p>
        </div>

        <!-- How The Platform Works -->
        <div style="max-width: 900px; margin: 40px auto; padding: 0 20px;">
            <h3 style="font-size: 1.8rem; text-align: center; margin-bottom: 30px; color: #2c3e50;">The Complete Process</h3>
            
            <div class="steps-grid">
                <div class="step-card">
                    <div class="step-number">1</div>
                    <h3>Search & Browse</h3>
                    <p>Enter your service need (plumber, cleaner, tutor, etc.) and browse local professionals in your area. Filter by ratings, price, and availability.</p>
                </div>
                <div class="step-card">
                    <div class="step-number">2</div>
                    <h3>Review Profiles</h3>
                    <p>Check detailed profiles with verified credentials, customer reviews, past work photos, and transparent pricing. No hidden fees.</p>
                </div>
                <div class="step-card">
                    <div class="step-number">3</div>
                    <h3>Book Your Service</h3>
                    <p>Select a time slot that works for you and the provider. Confirm the booking with a detailed service description and agreed price.</p>
                </div>
                <div class="step-card">
                    <div class="step-number">4</div>
                    <h3>Secure Payment</h3>
                    <p>Pay securely through our platform. Your payment goes directly to the provider with 0% commission deducted by Task Masters.</p>
                </div>
                <div class="step-card">
                    <div class="step-number">5</div>
                    <h3>Service Delivery</h3>
                    <p>The professional arrives at your scheduled time and completes the service. Track your booking status in real-time through your dashboard.</p>
                </div>
                <div class="step-card">
                    <div class="step-number">6</div>
                    <h3>Rate & Review</h3>
                    <p>Share your experience by rating the provider. If you're not satisfied, our quality guarantee and support team are here to help.</p>
                </div>
            </div>
        </div>

        <!-- Future Videos Section -->
        <div style="text-align: center; margin-top: 50px; padding: 30px; background: #f8f9fa; border-radius: 15px;">
            <h3 style="color: #2c3e50; margin-bottom: 15px;">üìπ Video Guides Coming Soon</h3>
            <p style="color: #6c757d; font-size: 1.1rem;">We're creating step-by-step video tutorials to help you get the most out of Task Masters</p>
        </div>
    </section>

    <!-- Provider CTA -->
    <section class="provider-cta">
        <div class="cta-content">
            <h2>Want to Earn as a Service Provider?</h2>
            <p>Join thousands of professionals earning on their own schedule</p>
            <div class="cta-highlight">‚ú® Zero commission from Task Masters ‚Ä¢ We don't take a cut ‚ú®</div>
            <a href="service-provider-login.html" class="btn-cta">Register as Provider</a>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>üéØ Task Masters</h3>
                <p>Your trusted service marketplace</p>
            </div>
            <div class="footer-section">
                <h4>Company</h4>
                <a href="about.html">About Us</a>
                <a href="careers.html">Careers</a>
                <a href="contact.html">Contact Us</a>
            </div>
            <div class="footer-section">
                <h4>Support</h4>
                <a href="help.html">Help Center</a>
                <a href="safety.html">Safety</a>
                <a href="terms.html">Terms of Service</a>
            </div>
            <div class="footer-section">
                <h4>For Providers</h4>
                <a href="service-provider-login.html">Provider Login</a>
                <a href="service-provider-login.html">Become a Provider</a>
                <a href="provider-resources.html">Provider Resources</a>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2026 Task Masters. All rights reserved.</p>
        </div>
    </footer>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Login</h2>
            <form class="login-form" onsubmit="handleCustomerLogin(event)">
                <input type="email" id="customerEmail" placeholder="Email Address" required />
                <input type="password" id="customerPassword" placeholder="Password" required />
                <div style="text-align: left; margin: 10px 0;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="customerRememberMe" style="width: auto; margin: 0;" />
                        <span style="color: #666; font-size: 14px;">Remember me</span>
                    </label>
                </div>
                <button type="submit" class="btn-submit">Login</button>
                <p class="form-footer">Don't have an account? <a href="#" onclick="showSignup()">Sign up</a></p>
            </form>
        </div>
    </div>

    <!-- Location Modal -->
    <div id="locationModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <h2 style="color: #667eea; margin-bottom: 15px; font-size: 1.8em;">üìç Set Your Location</h2>
            <p style="color: #666; margin-bottom: 25px; line-height: 1.6;">
                To show you the best service providers in your area, we need your location. 
                We respect your privacy and follow all government regulations.
            </p>
            
            <div style="display: flex; flex-direction: column; gap: 15px;">
                <button onclick="requestPreciseLocation()" class="btn-location-primary" 
                    style="padding: 15px 25px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 10px;">
                    <span style="font-size: 24px;">üìç</span>
                    <span>Use My Current Location</span>
                </button>
                
                <p style="color: #999; font-size: 12px; text-align: center; margin: -5px 0 5px 0; line-height: 1.4;">
                    Your browser will ask for permission to access your location
                </p>
                
                <div style="text-align: center; color: #999; font-size: 14px; margin: 10px 0;">OR</div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <label style="display: block; color: #333; font-weight: 600; margin-bottom: 10px;">üèôÔ∏è Search by City</label>
                    <div style="position: relative;">
                        <input type="text" id="citySearchInput" placeholder="e.g., Toronto, Vancouver, New York" 
                            style="width: 100%; padding: 12px 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;"
                            oninput="searchCities(this.value)" 
                            onfocus="searchCities(this.value)"
                            autocomplete="off" />
                        <div id="citySuggestions" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid #4A90E2; border-top: none; border-radius: 0 0 8px 8px; max-height: 250px; overflow-y: auto; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000;"></div>
                    </div>
                    <div id="citySearchResult" style="margin-top: 10px; font-size: 14px;"></div>
                </div>

                <div style="text-align: center; color: #999; font-size: 14px; margin: 10px 0;">OR</div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <label style="display: block; color: #333; font-weight: 600; margin-bottom: 10px;">üìÆ Enter Postal Code / ZIP Code</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="postalCodeInput" placeholder="e.g., M5H 2N2 or 10001" 
                            style="flex: 1; padding: 12px 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;"
                            oninput="this.value = this.value.toUpperCase()" />
                        <button onclick="submitPostalCode()" 
                            style="padding: 12px 25px; background: #4A90E2; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; white-space: nowrap;">
                            Submit
                        </button>
                    </div>
                    <div id="postalCodeResult" style="margin-top: 10px; font-size: 14px;"></div>
                </div>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background: #e7f3ff; border-left: 4px solid #2196F3; border-radius: 5px;">
                <p style="margin: 0; font-size: 14px; color: #0c5460;">
                    <strong>üîí Privacy Protected:</strong> We only access location data allowed by your government's privacy laws. 
                    Your precise coordinates are never shared with service providers.
                </p>
            </div>
            
            <button onclick="skipLocationForNow()" 
                style="margin-top: 15px; width: 100%; padding: 12px; background: #f8f9fa; color: #666; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; font-size: 14px;">
                Skip for now (show all providers)
            </button>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // INLINE SEARCH AUTOSUGGESTION - Ensures it always works
        (function() {
            // Complete services list for autosuggestion
            const allSearchServices = [
                { name: 'Photographer', keywords: ['phot', 'photo', 'photographer', 'photography', 'camera', 'pictures'], category: 'Photography', emoji: 'üì∏' },
                { name: 'Videographer', keywords: ['video', 'videographer', 'videography', 'cinematography'], category: 'Videography', emoji: 'üé•' },
                { name: 'Wedding Planner', keywords: ['wedding', 'wedding planner', 'marriage', 'shaadi'], category: 'Event Planning', emoji: 'üíç' },
                { name: 'Event Planner', keywords: ['event', 'party planner', 'event planner', 'birthday', 'celebration'], category: 'Event Planning', emoji: 'üéâ' },
                { name: 'Wedding Decorator', keywords: ['wedding decorator', 'marriage decoration', 'mandap'], category: 'Decoration', emoji: 'üíê' },
                { name: 'Event Decorator', keywords: ['event decorator', 'party decorator', 'balloon', 'decoration'], category: 'Decoration', emoji: 'üéà' },
                { name: 'Mehendi Artist', keywords: ['mehendi', 'mehndi', 'henna', 'bridal mehendi'], category: 'Beauty & Art', emoji: 'üé®' },
                { name: 'Catering', keywords: ['catering', 'food', 'party food', 'event food'], category: 'Food Services', emoji: 'üçΩÔ∏è' },
                { name: 'Personal Chef', keywords: ['chef', 'cook', 'personal chef', 'home chef'], category: 'Food Services', emoji: 'üë®‚Äçüç≥' },
                { name: 'DJ', keywords: ['dj', 'disc jockey', 'music', 'party dj'], category: 'Entertainment', emoji: 'üéß' },
                { name: 'Dance Teacher', keywords: ['dance', 'dance teacher', 'choreographer', 'dance class'], category: 'Education & Arts', emoji: 'üíÉ' },
                { name: 'Music Teacher', keywords: ['music teacher', 'music class', 'singing', 'instrument'], category: 'Education & Arts', emoji: 'üéµ' },
                { name: 'Home Cleaning', keywords: ['cleaning', 'home cleaning', 'house cleaning', 'deep clean'], category: 'Home Services', emoji: 'üßπ' },
                { name: 'Maid Service', keywords: ['maid', 'housekeeping', 'domestic help'], category: 'Home Services', emoji: 'üè†' },
                { name: 'Plumbing', keywords: ['plumber', 'plumbing', 'pipe', 'leak', 'tap', 'water'], category: 'Home Repair', emoji: 'üîß' },
                { name: 'Electrical Work', keywords: ['electrician', 'electrical', 'wiring', 'power', 'switch'], category: 'Home Repair', emoji: '‚ö°' },
                { name: 'Carpentry', keywords: ['carpenter', 'carpentry', 'wood', 'furniture'], category: 'Home Repair', emoji: 'ü™ö' },
                { name: 'Painting', keywords: ['painter', 'painting', 'wall paint', 'house paint'], category: 'Home Improvement', emoji: 'üé®' },
                { name: 'Makeup Artist', keywords: ['makeup', 'mua', 'bridal makeup', 'party makeup'], category: 'Beauty Services', emoji: 'üíÑ' },
                { name: 'Hairstylist', keywords: ['hair', 'hairstylist', 'haircut', 'salon'], category: 'Beauty Services', emoji: 'üíá' },
                { name: 'Barber', keywords: ['barber', 'mens haircut', 'shave', 'beard'], category: 'Beauty Services', emoji: 'üíà' },
                { name: 'Manicure Pedicure', keywords: ['manicure', 'pedicure', 'nails', 'nail art'], category: 'Beauty Services', emoji: 'üíÖ' },
                { name: 'Massage', keywords: ['massage', 'spa', 'body massage', 'relaxation'], category: 'Wellness', emoji: 'üíÜ' },
                { name: 'Yoga Instructor', keywords: ['yoga', 'meditation', 'yoga class', 'fitness'], category: 'Fitness & Wellness', emoji: 'üßò' },
                { name: 'Personal Training', keywords: ['trainer', 'gym', 'fitness', 'workout'], category: 'Fitness & Wellness', emoji: 'üí™' },
                { name: 'Physiotherapy', keywords: ['physio', 'physiotherapy', 'therapy', 'rehabilitation'], category: 'Healthcare', emoji: 'üè•' },
                { name: 'Dietitian', keywords: ['diet', 'dietitian', 'nutrition', 'weight loss'], category: 'Healthcare', emoji: 'ü•ó' },
                { name: 'Tutoring', keywords: ['tutor', 'tutoring', 'teaching', 'education', 'home tutor'], category: 'Education', emoji: 'üìö' },
                { name: 'Babysitting', keywords: ['babysitter', 'babysitting', 'nanny', 'childcare'], category: 'Childcare', emoji: 'üë∂' },
                { name: 'Dog Sitting', keywords: ['dog', 'dog sitting', 'pet sitting', 'dog walker'], category: 'Pet Care', emoji: 'üêï' },
                { name: 'Cat Sitting', keywords: ['cat', 'cat sitting', 'pet care'], category: 'Pet Care', emoji: 'üêà' },
                { name: 'Pet Grooming', keywords: ['pet grooming', 'dog grooming', 'pet bath'], category: 'Pet Care', emoji: '‚úÇÔ∏è' },
                { name: 'Pest Control', keywords: ['pest', 'pest control', 'termite', 'bugs', 'insects'], category: 'Home Services', emoji: 'üêõ' },
                { name: 'AC Repair', keywords: ['ac', 'air conditioning', 'ac repair', 'cooling'], category: 'Home Repair', emoji: '‚ùÑÔ∏è' },
                { name: 'Moving & Packing', keywords: ['moving', 'packing', 'movers', 'relocation'], category: 'Moving Services', emoji: 'üì¶' },
                { name: 'Tailor', keywords: ['tailor', 'stitching', 'alteration', 'clothes'], category: 'Fashion Services', emoji: 'üßµ' },
                { name: 'Interior Designer', keywords: ['interior', 'interior design', 'home design'], category: 'Design Services', emoji: 'üè†' },
                { name: 'Gardener', keywords: ['garden', 'gardener', 'lawn', 'landscaping', 'plants'], category: 'Outdoor Services', emoji: 'üåø' },
                { name: 'Car Wash', keywords: ['car wash', 'car cleaning', 'vehicle wash'], category: 'Vehicle Services', emoji: 'üöó' },
                { name: 'Home Appliance Repair', keywords: ['appliance', 'fridge repair', 'washing machine'], category: 'Repair Services', emoji: 'üîß' },
                { name: 'Astrologer', keywords: ['astrologer', 'horoscope', 'kundli', 'jyotish'], category: 'Spiritual Services', emoji: '‚≠ê' },
                { name: 'Pandit', keywords: ['pandit', 'priest', 'puja', 'pooja'], category: 'Spiritual Services', emoji: 'üôè' },
                { name: 'Tattoo Artist', keywords: ['tattoo', 'body art', 'ink'], category: 'Body Art', emoji: 'üñäÔ∏è' },
                { name: 'Concierge', keywords: ['concierge', 'personal assistant', 'errand'], category: 'Lifestyle Services', emoji: 'üé©' }
            ];

            function inlineShowSuggestions(query) {
                const suggestionsDiv = document.getElementById('searchSuggestions');
                if (!suggestionsDiv || !query || query.length < 1) {
                    if (suggestionsDiv) suggestionsDiv.style.display = 'none';
                    return;
                }

                const q = query.toLowerCase().trim();
                
                // First try exact matches
                let matches = allSearchServices.filter(service =>
                    service.keywords.some(kw => kw.includes(q)) || service.name.toLowerCase().includes(q)
                ).slice(0, 8);

                let correctionMessage = '';
                let correctedQuery = q;

                // If no matches found, try fuzzy matching (autocorrect) with substring/prefix boost
                if (matches.length === 0 && q.length >= 3) {
                    // Enhanced fuzzy matching with substring and prefix detection
                    function calculateSimilarityPercent(userInput, targetString) {
                        const distance = getEditDistance(userInput, targetString);
                        const maxLen = Math.max(userInput.length, targetString.length);
                        let similarityPercent = ((maxLen - distance) / maxLen) * 100;
                        
                        // BOOST: substring match (20% bonus)
                        if (targetString.includes(userInput)) {
                            similarityPercent = Math.min(100, similarityPercent + 20);
                        }
                        
                        // BOOST: prefix match (30% bonus)
                        if (targetString.startsWith(userInput)) {
                            similarityPercent = Math.min(100, similarityPercent + 30);
                        }
                        
                        return similarityPercent;
                    }

                    function getEditDistance(s1, s2) {
                        s1 = s1.toLowerCase();
                        s2 = s2.toLowerCase();
                        const costs = [];
                        for (let i = 0; i <= s1.length; i++) {
                            let lastValue = i;
                            for (let j = 0; j <= s2.length; j++) {
                                if (i === 0) {
                                    costs[j] = j;
                                } else if (j > 0) {
                                    let newValue = costs[j - 1];
                                    if (s1.charAt(i - 1) !== s2.charAt(j - 1)) {
                                        newValue = Math.min(Math.min(newValue, lastValue), costs[j]) + 1;
                                    }
                                    costs[j - 1] = lastValue;
                                    lastValue = newValue;
                                }
                            }
                            if (i > 0) costs[s2.length] = lastValue;
                        }
                        return costs[s2.length];
                    }

                    // Find best match from all keywords and service names with 40% threshold
                    let bestMatch = null;
                    let bestScore = 0;

                    allSearchServices.forEach(service => {
                        // Check service name
                        const nameScore = calculateSimilarityPercent(q, service.name.toLowerCase());
                        if (nameScore > bestScore) {
                            bestScore = nameScore;
                            bestMatch = service.name.toLowerCase();
                        }

                        // Check keywords
                        service.keywords.forEach(keyword => {
                            const score = calculateSimilarityPercent(q, keyword);
                            if (score > bestScore) {
                                bestScore = score;
                                bestMatch = keyword;
                            }
                        });
                    });

                    // If we found a match above 40% threshold, search with it
                    if (bestMatch && bestScore >= 40) {
                        correctedQuery = bestMatch;
                        matches = allSearchServices.filter(service =>
                            service.keywords.some(kw => kw.includes(bestMatch)) || service.name.toLowerCase().includes(bestMatch)
                        ).slice(0, 8);

                        // Don't show correction message in search dropdown
                        // The correction will be shown on the results page instead
                    }
                }

                if (matches.length === 0) {
                    suggestionsDiv.innerHTML = `
                        <div style="padding: 20px; text-align: center; color: #999;">
                            <span style="font-size: 24px;">üîç</span>
                            <div style="margin-top: 8px; font-size: 14px;">No services found for "${q}"</div>
                            <div style="margin-top: 4px; font-size: 13px;">Try different keywords</div>
                        </div>
                    `;
                    suggestionsDiv.style.display = 'block';
                    return;
                }

                const resultsHTML = matches.map(service => `
                    <div onclick="var input = document.getElementById('serviceSearch'); input.value='${service.name}'; document.getElementById('searchSuggestions').style.display='none'; window.location.href='services.html?service=${encodeURIComponent(service.name.toLowerCase())}';"
                         style="padding: 15px 20px; cursor: pointer; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; gap: 12px; transition: background 0.2s;"
                         onmouseover="this.style.background='#f0f7ff'"
                         onmouseout="this.style.background='white'">
                        <span style="font-size: 24px;">${service.emoji}</span>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: #2c3e50; font-size: 15px;">${service.name}</div>
                            <div style="font-size: 13px; color: #6c757d; margin-top: 2px;">in ${service.category}</div>
                        </div>
                    </div>
                `).join('');

                // Show suggestions without correction message on search page
                // Correction will be shown on the results page (services.html)
                suggestionsDiv.innerHTML = resultsHTML;
                suggestionsDiv.style.display = 'block';
            }

            // Override the global function
            window.showSearchSuggestions = inlineShowSuggestions;

            // Also attach directly to input
            const searchInput = document.getElementById('serviceSearch');
            if (searchInput) {
                searchInput.oninput = function() { inlineShowSuggestions(this.value); };
                searchInput.onfocus = function() { if(this.value) inlineShowSuggestions(this.value); };
            }

            // Hide on click outside
            document.addEventListener('click', function(e) {
                const search = document.getElementById('serviceSearch');
                const sugg = document.getElementById('searchSuggestions');
                if (sugg && search && !search.contains(e.target) && !sugg.contains(e.target)) {
                    sugg.style.display = 'none';
                }
            });
        })();

        // Navigation login status is now handled IMMEDIATELY inline after the button is created
        // This DOMContentLoaded only handles the location modal
        window.addEventListener('DOMContentLoaded', () => {
            // Check and show location modal if not set
            setTimeout(() => {
                checkAndShowLocationModal();
            }, 200);
        });

        // Location Functions
        function checkAndShowLocationModal() {
            // Check if user has 'always' permission and update location
            const trackAlways = localStorage.getItem('trackLocationAlways');
            const hasLocation = LocationService.hasLocation();
            
            if (trackAlways === 'true' && hasLocation) {
                // Silently update location in background
                LocationService.requestPreciseLocation()
                    .then(location => {
                        console.log('üîÑ Location updated automatically:', LocationService.formatLocation(location));
                        updateLocationDisplay();
                    })
                    .catch(error => {
                        console.log('‚ö†Ô∏è Auto-update failed, using stored location');
                    });
            }
            
            if (!hasLocation) {
                console.log('üìç No location set, showing modal...');
                setTimeout(() => {
                    document.getElementById('locationModal').style.display = 'flex';
                }, 1000); // Show after 1 second
            } else {
                console.log('‚úÖ Location already set:', LocationService.formatLocation(LocationService.getLocation()));
                updateLocationDisplay();
            }
        }

        function updateLocationDisplay() {
            const location = LocationService.getLocation();
            if (location) {
                // Update location input in header
                const locationInput = document.getElementById('locationInput');
                if (locationInput) {
                    locationInput.value = LocationService.formatLocation(location);
                }
                
                // Show location badge
                showLocationBadge(location);
            }
        }

        function showLocationBadge(location) {
            const badge = document.createElement('div');
            badge.style.cssText = 'position: fixed; top: 80px; right: 20px; background: white; padding: 12px 20px; border-radius: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; display: flex; align-items: center; gap: 10px; animation: slideIn 0.3s ease;';
            badge.innerHTML = `
                <span style="font-size: 20px;">üìç</span>
                <span style="font-weight: 600; color: #333;">${LocationService.formatLocation(location)}</span>
                <button onclick="changeLocation()" style="background: #f0f0f0; border: none; padding: 5px 12px; border-radius: 15px; cursor: pointer; font-size: 12px; color: #667eea; font-weight: 600;">Change</button>
            `;
            badge.id = 'locationBadge';
            document.body.appendChild(badge);
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                badge.style.opacity = '0';
                badge.style.transition = 'opacity 0.3s ease';
                setTimeout(() => badge.remove(), 300);
            }, 5000);
        }

        function changeLocation() {
            document.getElementById('locationModal').style.display = 'flex';
            const badge = document.getElementById('locationBadge');
            if (badge) badge.remove();
        }

        async function requestPreciseLocation() {
            const modal = document.getElementById('locationModal');
            const resultDiv = document.getElementById('postalCodeResult');
            
            // Check if site is running on HTTPS (required for geolocation)
            if (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost' && !window.location.hostname.startsWith('127.0.0.1')) {
                resultDiv.innerHTML = `
                    <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; border-radius: 4px; margin: 15px 0;">
                        <div style="color: #856404; font-weight: 600; margin-bottom: 8px;">üîí HTTPS Required</div>
                        <div style="color: #856404; font-size: 14px; line-height: 1.5;">
                            Browser location access requires a secure (HTTPS) connection. Please enter your postal code instead.
                        </div>
                    </div>
                `;
                
                // Focus on postal code input
                const postalInput = document.getElementById('postalCodeInput');
                if (postalInput) {
                    setTimeout(() => {
                        postalInput.focus();
                        postalInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 100);
                }
                return;
            }
            
            // Check if geolocation is supported
            if (!navigator.geolocation) {
                resultDiv.innerHTML = `
                    <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; border-radius: 4px; margin: 15px 0;">
                        <div style="color: #856404; font-weight: 600; margin-bottom: 8px;">‚ö†Ô∏è Not Supported</div>
                        <div style="color: #856404; font-size: 14px; line-height: 1.5;">
                            Your browser doesn't support geolocation. Please enter your postal code instead.
                        </div>
                    </div>
                `;
                
                // Focus on postal code input
                const postalInput = document.getElementById('postalCodeInput');
                if (postalInput) {
                    setTimeout(() => {
                        postalInput.focus();
                        postalInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 100);
                }
                return;
            }
            
            // CRITICAL FIX: Request browser geolocation IMMEDIATELY on user click
            // Browsers require geolocation API to be called directly from user gesture
            try {
                resultDiv.innerHTML = '<div style="color: #2196F3;">üîÑ Requesting location permission from your browser...</div>';
                
                // Call the browser's geolocation API DIRECTLY
                const location = await LocationService.requestPreciseLocation();
                
                // Success! Show options for remembering preference
                resultDiv.innerHTML = `
                    <div style="background: #d4edda; border-left: 4px solid #28a745; padding: 15px; border-radius: 4px; margin: 15px 0;">
                        <div style="color: #155724; font-weight: 600; margin-bottom: 8px;">‚úÖ Location Detected</div>
                        <div style="color: #155724; font-size: 14px; margin-bottom: 15px;">
                            ${LocationService.formatLocation(location)}
                        </div>
                        <div style="color: #155724; font-size: 13px; margin-top: 10px;">
                            Would you like us to remember this for next time?
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button onclick="saveLocationPreference('always')" 
                                    style="flex: 1; background: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 13px;">
                                Yes, Remember
                            </button>
                            <button onclick="saveLocationPreference('once')" 
                                    style="flex: 1; background: #6c757d; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 13px;">
                                Just This Once
                            </button>
                        </div>
                    </div>
                `;
                
                // Auto-close after 3 seconds if user doesn't choose
                setTimeout(() => {
                    if (modal.style.display !== 'none') {
                        saveLocationPreference('once');
                    }
                }, 3000);
                
            } catch (error) {
                console.log('‚ùå Geolocation error:', error);
                
                // Handle different error types
                let errorMessage = '';
                let errorIcon = '‚ö†Ô∏è';
                
                if (error.code === 1) {
                    errorMessage = 'You denied location access in your browser. Please enter your postal code instead or refresh and allow location when prompted.';
                    errorIcon = 'üö´';
                } else if (error.code === 2) {
                    errorMessage = 'Location unavailable. Your device could not determine your location. Please enter your postal code instead.';
                } else if (error.code === 3) {
                    errorMessage = 'Location request timed out. Please check your internet connection or enter your postal code instead.';
                } else {
                    errorMessage = error.message || 'Unable to get location. Please enter your postal code instead.';
                }
                
                resultDiv.innerHTML = `
                    <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; border-radius: 4px; margin: 15px 0;">
                        <div style="color: #856404; font-weight: 600; margin-bottom: 8px;">${errorIcon} Location Not Available</div>
                        <div style="color: #856404; font-size: 14px; line-height: 1.5;">${errorMessage}</div>
                    </div>
                `;
                
                // Focus on postal code input
                const postalInput = document.getElementById('postalCodeInput');
                if (postalInput) {
                    setTimeout(() => {
                        postalInput.focus();
                        postalInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 100);
                }
            }
        }

        function saveLocationPreference(preference) {
            const modal = document.getElementById('locationModal');
            
            // Store preference
            localStorage.setItem('locationPermission', preference);
            localStorage.setItem('trackLocationAlways', preference === 'always' ? 'true' : 'false');
            
            // Close modal and update display
            modal.style.display = 'none';
            updateLocationDisplay();
            
            console.log('üìç Location preference saved:', preference);
        }

        function submitPostalCode() {
            const input = document.getElementById('postalCodeInput');
            const postalCode = input.value.trim();
            const resultDiv = document.getElementById('postalCodeResult');
            
            if (!postalCode) {
                resultDiv.innerHTML = '<div style="color: #dc3545;">Please enter a postal code</div>';
                return;
            }
            
            const result = LocationService.setLocationByPostalCode(postalCode);
            
            if (result.success) {
                const loc = result.location;
                resultDiv.innerHTML = `<div style="color: #28a745; font-weight: 600;">‚úÖ ${loc.city}, ${loc.region}</div>`;
                
                setTimeout(() => {
                    document.getElementById('locationModal').style.display = 'none';
                    updateLocationDisplay();
                }, 1500);
            } else {
                resultDiv.innerHTML = `<div style="color: #dc3545;">‚ùå ${result.error}. Please try a different postal code.</div>`;
            }
        }

        function skipLocationForNow() {
            document.getElementById('locationModal').style.display = 'none';
            console.log('‚è≠Ô∏è User skipped location setting');
        }

        // Allow Enter key to submit postal code
        document.addEventListener('DOMContentLoaded', () => {
            const postalInput = document.getElementById('postalCodeInput');
            if (postalInput) {
                postalInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        submitPostalCode();
                    }
                });
            }
        });

        // Mobile menu toggle
        function toggleMobileMenu() {
            const navLinks = document.getElementById('navLinks');
            const menuToggle = document.getElementById('mobileMenuToggle');
            navLinks.classList.toggle('active');
            menuToggle.classList.toggle('active');
        }

        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            const navLinks = document.getElementById('navLinks');
            const menuToggle = document.getElementById('mobileMenuToggle');
            const navbar = document.querySelector('.navbar');
            
            if (navLinks && menuToggle && navbar) {
                if (!navbar.contains(event.target) && navLinks.classList.contains('active')) {
                    navLinks.classList.remove('active');
                    menuToggle.classList.remove('active');
                }
            }
        });

        // Close mobile menu when clicking a link
        document.querySelectorAll('.nav-links a, .nav-links button').forEach(link => {
            link.addEventListener('click', function() {
                const navLinks = document.getElementById('navLinks');
                const menuToggle = document.getElementById('mobileMenuToggle');
                if (navLinks && menuToggle) {
                    navLinks.classList.remove('active');
                    menuToggle.classList.remove('active');
                }
            });
        });

        // City Search Functionality with Autocomplete and Spell Correction
        let allCities = [];
        
        // Extract unique cities from postal code database
        function buildCityDatabase() {
            const cityMap = new Map();
            const db = LocationService.postalCodeDatabase;
            
            for (let code in db) {
                const entry = db[code];
                const city = entry.city;
                const region = entry.province || entry.state;
                const country = entry.country;
                const key = `${city}|${region}|${country}`;
                
                if (!cityMap.has(key)) {
                    cityMap.set(key, {
                        city: city,
                        region: region,
                        country: country,
                        lat: entry.lat,
                        lng: entry.lng,
                        postalCode: code
                    });
                }
            }
            
            allCities = Array.from(cityMap.values());
            console.log('üìç City database built:', allCities.length, 'unique cities');
        }
        
        // Calculate Levenshtein distance for spell correction
        function levenshteinDistance(str1, str2) {
            const len1 = str1.length;
            const len2 = str2.length;
            const matrix = Array(len1 + 1).fill(null).map(() => Array(len2 + 1).fill(0));
            
            for (let i = 0; i <= len1; i++) matrix[i][0] = i;
            for (let j = 0; j <= len2; j++) matrix[0][j] = j;
            
            for (let i = 1; i <= len1; i++) {
                for (let j = 1; j <= len2; j++) {
                    const cost = str1[i - 1].toLowerCase() === str2[j - 1].toLowerCase() ? 0 : 1;
                    matrix[i][j] = Math.min(
                        matrix[i - 1][j] + 1,
                        matrix[i][j - 1] + 1,
                        matrix[i - 1][j - 1] + cost
                    );
                }
            }
            
            return matrix[len1][len2];
        }
        
        // Search cities with fuzzy matching
        function searchCities(query) {
            const suggestionsDiv = document.getElementById('citySuggestions');
            const resultDiv = document.getElementById('citySearchResult');
            
            if (!query || query.trim().length < 2) {
                suggestionsDiv.style.display = 'none';
                resultDiv.innerHTML = '';
                return;
            }
            
            const searchTerm = query.trim().toLowerCase();
            let matches = [];
            
            // Find matches with scoring
            allCities.forEach(cityData => {
                const cityLower = cityData.city.toLowerCase();
                const distance = levenshteinDistance(searchTerm, cityLower);
                const maxLen = Math.max(searchTerm.length, cityLower.length);
                const similarity = ((maxLen - distance) / maxLen) * 100;
                
                // Boost exact prefix matches
                let score = similarity;
                if (cityLower.startsWith(searchTerm)) {
                    score += 50;
                }
                
                // Include partial matches
                if (cityLower.includes(searchTerm)) {
                    score += 25;
                }
                
                // Only include if reasonable match
                if (score >= 40 || cityLower.includes(searchTerm)) {
                    matches.push({
                        ...cityData,
                        score: score,
                        distance: distance
                    });
                }
            });
            
            // Sort by score (higher is better)
            matches.sort((a, b) => b.score - a.score);
            
            // Limit to top 10 results
            matches = matches.slice(0, 10);
            
            if (matches.length === 0) {
                suggestionsDiv.style.display = 'none';
                resultDiv.innerHTML = `<div style="color: #856404; background: #fff3cd; padding: 10px; border-radius: 5px; margin-top: 10px;">
                    ‚ö†Ô∏è No cities found matching "${query}". Try a different spelling.
                </div>`;
                return;
            }
            
            // Display suggestions
            let html = '';
            matches.forEach((match, index) => {
                const displayText = `${match.city}, ${match.region}, ${match.country}`;
                html += `
                    <div onclick="selectCity('${match.city}', '${match.region}', '${match.country}', ${match.lat}, ${match.lng}, '${match.postalCode}')" 
                         style="padding: 12px 15px; cursor: pointer; border-bottom: 1px solid #eee; transition: background 0.2s;"
                         onmouseover="this.style.background='#f0f7ff'"
                         onmouseout="this.style.background='white'">
                        <div style="font-weight: 600; color: #333;">${match.city}</div>
                        <div style="font-size: 13px; color: #666;">${match.region}, ${match.country}</div>
                    </div>
                `;
            });
            
            suggestionsDiv.innerHTML = html;
            suggestionsDiv.style.display = 'block';
            resultDiv.innerHTML = '';
            
            // Show spell correction hint if needed
            if (matches[0].distance > 0 && matches[0].distance <= 3) {
                resultDiv.innerHTML = `<div style="color: #0c5460; background: #d1ecf1; padding: 8px; border-radius: 5px; margin-top: 10px; font-size: 13px;">
                    üí° Did you mean "<strong>${matches[0].city}</strong>"?
                </div>`;
            }
        }
        
        // Select a city from suggestions
        function selectCity(city, region, country, lat, lng, postalCode) {
            const modal = document.getElementById('locationModal');
            const suggestionsDiv = document.getElementById('citySuggestions');
            const resultDiv = document.getElementById('citySearchResult');
            const cityInput = document.getElementById('citySearchInput');
            
            // Set location
            const locationData = {
                type: 'city',
                city: city,
                region: region,
                country: country,
                lat: lat,
                lng: lng,
                postalCode: postalCode,
                timestamp: Date.now()
            };
            
            LocationService.saveLocation(locationData);
            
            // Update UI
            cityInput.value = `${city}, ${region}`;
            suggestionsDiv.style.display = 'none';
            resultDiv.innerHTML = `<div style="color: #155724; background: #d4edda; padding: 10px; border-radius: 5px; margin-top: 10px; font-weight: 600;">
                ‚úÖ Location set: ${city}, ${region}, ${country}
            </div>`;
            
            // Close modal after 1.5 seconds
            setTimeout(() => {
                modal.style.display = 'none';
                updateLocationDisplay();
            }, 1500);
        }
        
        // Build city database when location service is ready
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                buildCityDatabase();
            }, 100);
            
            // Close suggestions when clicking outside
            document.addEventListener('click', (e) => {
                const cityInput = document.getElementById('citySearchInput');
                const suggestionsDiv = document.getElementById('citySuggestions');
                
                if (cityInput && suggestionsDiv && !cityInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
                    suggestionsDiv.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
