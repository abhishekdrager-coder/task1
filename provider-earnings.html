<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Earnings - Provider Dashboard</title>
    <link rel="stylesheet" href="styles.css?v=16.1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        /* Force page to never cache */
        html { -webkit-transform: translateZ(0); transform: translateZ(0); }
    </style>
    <script>
        (function() {
            const isLoggedIn = localStorage.getItem('providerLoggedIn');
            if (isLoggedIn !== 'true') {
                window.location.href = 'service-provider-login.html';
            }
        })();
    </script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="provider.html" style="text-decoration: none;">
                    <div class="logo-wrapper">
                        <span class="logo-icon">üéØ</span>
                        <span class="logo-text">Task Masters</span>
                    </div>
                </a>
            </div>
            <div class="nav-actions">
                <a href="provider.html" class="nav-btn" style="display: flex; align-items: center; gap: 8px; padding: 12px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 25px; text-decoration: none; color: white; font-weight: 600; font-size: 15px;">‚Üê Back to Dashboard</a>
            </div>
        </div>
    </nav>

    <div style="max-width: 1400px; margin: 40px auto; padding: 0 20px;">
        <h1 style="margin: 0 0 30px 0; font-size: 2.5em; color: #2c3e50;">üí∞ Earnings Overview</h1>

        <!-- Earnings Summary Cards -->
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 40px;">
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 15px; color: white; box-shadow: 0 4px 15px rgba(102,126,234,0.3);">
                <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 10px;">üìÖ This Week</div>
                <div style="font-size: 2.2em; font-weight: bold;" id="weeklyEarning">$0</div>
            </div>
            <div style="background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%); padding: 30px; border-radius: 15px; color: white; box-shadow: 0 4px 15px rgba(76,175,80,0.3);">
                <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 10px;">üìä This Month</div>
                <div style="font-size: 2.2em; font-weight: bold;" id="monthlyEarning">$0</div>
            </div>
            <div style="background: linear-gradient(135deg, #ff9800 0%, #ffa726 100%); padding: 30px; border-radius: 15px; color: white; box-shadow: 0 4px 15px rgba(255,152,0,0.3);">
                <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 10px;">üìà This Quarter</div>
                <div style="font-size: 2.2em; font-weight: bold;" id="quarterlyEarning">$0</div>
            </div>
            <div style="background: linear-gradient(135deg, #f44336 0%, #e57373 100%); padding: 30px; border-radius: 15px; color: white; box-shadow: 0 4px 15px rgba(244,67,54,0.3);">
                <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 10px;">üéØ This Year</div>
                <div style="font-size: 2.2em; font-weight: bold;" id="yearlyEarning">$0</div>
            </div>
        </div>

        <!-- Custom Date Range -->
        <div style="background: white; padding: 30px; border-radius: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); margin-bottom: 30px;">
            <h2 style="margin: 0 0 20px 0; color: #2c3e50;">üìÜ Custom Date Range</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 20px; align-items: end;">
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #666;">From Date</label>
                    <input type="date" id="fromDate" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #666;">To Date</label>
                    <input type="date" id="toDate" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em;">
                </div>
                <div>
                    <button onclick="calculateCustomRange()" style="padding: 12px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1em;">Calculate</button>
                </div>
            </div>
            <div id="customRangeResult" style="margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 10px; display: none;">
                <div style="font-size: 1.1em; color: #666; margin-bottom: 8px;">Earnings for Selected Period:</div>
                <div style="font-size: 2.5em; font-weight: bold; color: #667eea;" id="customRangeAmount">$0</div>
            </div>
        </div>

        <!-- Earnings Calendar -->
        <div style="background: white; padding: 30px; border-radius: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #f0f0f0;">
                <button onclick="changeMonth(-1)" style="padding: 10px 20px; background: white; color: #333; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.95em; transition: all 0.2s;">
                    <i class="fas fa-chevron-left"></i> Prev
                </button>
                <h2 id="calendarMonth" style="margin: 0; color: #1a1a1a; font-size: 1.6em; font-weight: 600;">January 2026</h2>
                <button onclick="changeMonth(1)" style="padding: 10px 20px; background: white; color: #333; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.95em; transition: all 0.2s;">
                    Next <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            
            <!-- Calendar Grid -->
            <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: #e5e7eb; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden;">
                <!-- Day Headers -->
                <div style="background: #f9fafb; padding: 12px; text-align: center; font-weight: 600; color: #6b7280; font-size: 0.875em;">SUN</div>
                <div style="background: #f9fafb; padding: 12px; text-align: center; font-weight: 600; color: #6b7280; font-size: 0.875em;">MON</div>
                <div style="background: #f9fafb; padding: 12px; text-align: center; font-weight: 600; color: #6b7280; font-size: 0.875em;">TUE</div>
                <div style="background: #f9fafb; padding: 12px; text-align: center; font-weight: 600; color: #6b7280; font-size: 0.875em;">WED</div>
                <div style="background: #f9fafb; padding: 12px; text-align: center; font-weight: 600; color: #6b7280; font-size: 0.875em;">THU</div>
                <div style="background: #f9fafb; padding: 12px; text-align: center; font-weight: 600; color: #6b7280; font-size: 0.875em;">FRI</div>
                <div style="background: #f9fafb; padding: 12px; text-align: center; font-weight: 600; color: #6b7280; font-size: 0.875em;">SAT</div>
                
                <!-- Calendar Days Container -->
                <div id="calendarDays" style="display: contents;"></div>
            </div>
        </div>
    </div>

    <!-- Modal for earnings breakdown -->
    <div id="earningsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: white; padding: 32px; border-radius: 12px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04); max-width: 420px; width: 90%;">
            <h3 style="margin: 0 0 20px 0; color: #111827; font-size: 1.3em; font-weight: 600;" id="modalTitle">Earnings Breakdown</h3>
            
            <div style="background: #f9fafb; padding: 24px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #e5e7eb;">
                <div style="font-size: 0.875em; color: #6b7280; margin-bottom: 8px; font-weight: 500;">TOTAL EARNINGS</div>
                <div style="font-size: 2.5em; font-weight: 700; color: #111827;" id="modalTotal">$0.00</div>
            </div>
            
            <div style="display: grid; gap: 12px; margin-bottom: 24px;">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px; background: #f0fdf4; border-radius: 8px; border-left: 4px solid #10b981;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="font-size: 1.5em;">üíµ</div>
                        <div style="font-size: 0.9em; color: #065f46; font-weight: 500;">Cash Payment</div>
                    </div>
                    <div style="font-size: 1.3em; font-weight: 700; color: #059669;" id="modalCash">$0.00</div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px; background: #eff6ff; border-radius: 8px; border-left: 4px solid #3b82f6;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="font-size: 1.5em;">üí≥</div>
                        <div style="font-size: 0.9em; color: #1e40af; font-weight: 500;">Online Payment</div>
                    </div>
                    <div style="font-size: 1.3em; font-weight: 700; color: #2563eb;" id="modalOnline">$0.00</div>
                </div>
            </div>
            
            <button onclick="closeModal()" style="width: 100%; padding: 12px; background: #3b82f6; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1em; transition: background 0.2s;">Close</button>
        </div>
    </div>

    <script>
        let currentCalendarDate = new Date();
        // Store earnings data with cash and online splits
        // Format: 'YYYY-MM-DD': { cash: amount, online: amount }
        const earningsData = {};

        // Initialize earnings summary
        updateEarningsSummary();

        // Initialize calendar
        renderCalendar();

        function updateEarningsSummary() {
            // Calculate earnings for different periods
            let weeklyTotal = 0, monthlyTotal = 0, quarterlyTotal = 0, yearlyTotal = 0;
            const now = new Date();
            
            // Calculate from earningsData
            Object.keys(earningsData).forEach(dateStr => {
                const date = new Date(dateStr);
                const earnings = earningsData[dateStr];
                const total = earnings.cash + earnings.online;
                
                // Week
                const weekAgo = new Date(now);
                weekAgo.setDate(weekAgo.getDate() - 7);
                if (date >= weekAgo) weeklyTotal += total;
                
                // Month
                if (date.getMonth() === now.getMonth() && date.getFullYear() === now.getFullYear()) {
                    monthlyTotal += total;
                }
                
                // Quarter
                const quarterAgo = new Date(now);
                quarterAgo.setMonth(quarterAgo.getMonth() - 3);
                if (date >= quarterAgo) quarterlyTotal += total;
                
                // Year
                if (date.getFullYear() === now.getFullYear()) yearlyTotal += total;
            });
            
            document.getElementById('weeklyEarning').textContent = '$' + weeklyTotal.toFixed(2);
            document.getElementById('monthlyEarning').textContent = '$' + monthlyTotal.toFixed(2);
            document.getElementById('quarterlyEarning').textContent = '$' + quarterlyTotal.toFixed(2);
            document.getElementById('yearlyEarning').textContent = '$' + yearlyTotal.toFixed(2);
        }

        function renderCalendar() {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            // Update month display
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('calendarMonth').textContent = monthNames[month] + ' ' + year;
            
            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Clear calendar
            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';
            
            // Add empty cells for days before month starts
            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.style.background = '#ffffff';
                emptyCell.style.minHeight = '90px';
                calendarDays.appendChild(emptyCell);
            }
            
            // Get today's date for comparison
            const today = new Date();
            const isCurrentMonth = month === today.getMonth() && year === today.getFullYear();
            
            // Add days of month
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const earnings = earningsData[dateStr] || { cash: 0, online: 0 };
                const totalEarning = earnings.cash + earnings.online;
                
                const isToday = isCurrentMonth && day === today.getDate();
                const isPast = new Date(year, month, day) < new Date(today.getFullYear(), today.getMonth(), today.getDate());
                
                const dayCell = document.createElement('div');
                dayCell.style.background = '#ffffff';
                dayCell.style.minHeight = '90px';
                dayCell.style.padding = '8px';
                dayCell.style.position = 'relative';
                dayCell.style.transition = 'all 0.15s ease';
                
                // Date number styling
                let dateNumberStyle = 'display: inline-block; width: 32px; height: 32px; line-height: 32px; border-radius: 50%; text-align: center; font-size: 0.9em; font-weight: 500; margin-bottom: 6px;';
                
                if (isToday) {
                    dateNumberStyle += 'background: #3b82f6; color: white; font-weight: 700;';
                } else if (isPast) {
                    dateNumberStyle += 'color: #9ca3af;';
                } else {
                    dateNumberStyle += 'color: #374151;';
                }
                
                // Build cell content
                let cellContent = `<div style="${dateNumberStyle}">${day}</div>`;
                
                // Add earnings if present
                if (totalEarning > 0) {
                    dayCell.style.cursor = 'pointer';
                    cellContent += `
                        <div style="background: #10b981; color: white; padding: 6px 8px; border-radius: 6px; font-size: 0.875em; font-weight: 600; text-align: center;">
                            $${totalEarning.toFixed(2)}
                        </div>
                    `;
                    
                    // Click event
                    dayCell.onclick = function() {
                        showEarningsModal(dateStr, day, earnings);
                    };
                    
                    // Hover effect
                    dayCell.onmouseenter = function() {
                        this.style.background = '#f0fdf4';
                    };
                    dayCell.onmouseleave = function() {
                        this.style.background = '#ffffff';
                    };
                }
                
                dayCell.innerHTML = cellContent;
                calendarDays.appendChild(dayCell);
            }
        }

        function showEarningsModal(dateStr, day, earnings) {
            const total = earnings.cash + earnings.online;
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            const dateParts = dateStr.split('-');
            const month = monthNames[parseInt(dateParts[1]) - 1];
            
            document.getElementById('modalTitle').textContent = `${month} ${day}, ${dateParts[0]}`;
            document.getElementById('modalTotal').textContent = '$' + total.toFixed(2);
            document.getElementById('modalCash').textContent = '$' + earnings.cash.toFixed(2);
            document.getElementById('modalOnline').textContent = '$' + earnings.online.toFixed(2);
            
            const modal = document.getElementById('earningsModal');
            modal.style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('earningsModal').style.display = 'none';
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('earningsModal');
            if (event.target === modal) {
                closeModal();
            }
        });

        function changeMonth(direction) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + direction);
            renderCalendar();
        }

        function calculateCustomRange() {
            const fromDate = document.getElementById('fromDate').value;
            const toDate = document.getElementById('toDate').value;
            
            if (!fromDate || !toDate) {
                alert('Please select both From and To dates');
                return;
            }
            
            if (new Date(fromDate) > new Date(toDate)) {
                alert('From date must be before To date');
                return;
            }
            
            // Calculate earnings for the selected range
            // This will be populated with real data from bookings
            let totalEarnings = 0;
            
            // Show result
            const resultDiv = document.getElementById('customRangeResult');
            resultDiv.style.display = 'block';
            document.getElementById('customRangeAmount').textContent = '$' + totalEarnings.toFixed(2);
        }
    </script>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>üéØ Task Masters</h3>
                <p>Your trusted service marketplace</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2026 Task Masters. All rights reserved.</p>
        </div>
    </footer>
</body>
</html>
